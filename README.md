# ДЗ - 6
## описание архитектурного решения и схема взаимодействия сервисов
1) В качестве api gateway использовал Ambassador
2) Регистрация нового пользователя через REST API sign-up - обрабатывается в сервисе profile без аутентификации.
2) Авторизация пользователя через REST API sign-in:

- Маршрутизируется на auth сервис; 
- Сервис auth запрашивает профиль пользователя в сервисе profile;
- Создаёт сессию, генерит jwt токен, сохраняет во внутреннем хранилище и пишет в куку id сессии.

3) Запросы профиля пользователя выполняются через REST API /user/:id к сервису profile с проверкой аутентификации (паттерн Forward-Auth)

- Ambassador выполняет аутентификацию через сервис auth;
- сервис auth по куке читает из хранилища сессию и добавляет заголовок x-auth-token;
- Ambassador отправляет запрос с заголовком x-auth-token в сервис profile;
- Сервис profile парсит и валидирует токен используя открытый ключ (получает его из сервиса auth из файла /well-known/jwks.json);
- Сервис profile проверяют есть ли у данного пользователя (по userId из payload токена) права на выполнение операции.
