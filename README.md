# ДЗ - 6
## описание архитектурного решения и схема взаимодействия сервисов
1. В качестве api gateway использовал Ambassador
2. Регистрация нового пользователя через REST API sign-up - обрабатывается в сервисе profile без аутентификации.
2. Авторизация пользователя через REST API sign-in:
2.1 Маршрутизируется на auth сервис; 
2.2 Сервис auth запрашивает профиль пользователя в сервисе profile;
2.3 Создаёт сессию, генерит jwt токен, сохраняет во внутреннем хранилище и пишет в куку id сессии.
3. Запросы профиля пользователя выполняются через REST API /user/:id к сервису profile с проверкой аутентификации (паттерн Forward-Auth)
3.1 Ambassador выполняет аутентификацию через сервис auth;
3.2 сервис auth по куке читает из хранилища сессию и добавляет заголовок x-auth-token;
3.3 Ambassador отправляет запрос с заголовком x-auth-token в сервис profile;
3.4 Сервис profile парсит и валидирует токен используя открытый ключ (получает его из сервиса auth из файла /well-known/jwks.json);
3.5 Сервис profile проверяют есть ли у данного пользователя (по userId из payload токена) права на выполнение операции.